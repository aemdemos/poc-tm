## HTML Generation and Preview (Override)

**CRITICAL: Do NOT manually create or overwrite `.html` files in the content directory.**

The auto-convert hook (`auto-convert-md.js`) automatically generates both `.plain.html` and `.html` whenever a `.md` file is written or edited:
- `.plain.html` — Fragment HTML used by `aem up --html-folder` for decoration
- `.html` — Full HTML with `<!DOCTYPE>`, `<head>` (including `head.html` scripts/styles), `<header>`, `<main>`, `<footer>`

**Do NOT call `convert_markdown_to_html` to create content `.html` files.** This produces a `<body><main>` wrapper without `<!DOCTYPE>` or `<head>`, which overwrites the correct hook-generated file and breaks EDS decoration (no scripts load, no sections wrap, no blocks decorate).

**Correct workflow:**
1. Create or edit the `.md` file in the `content/` directory
2. The hook auto-generates `.plain.html` and `.html` — no manual step needed
3. Preview at `http://localhost:3000/{path}` — decoration works automatically

**If decoration is not working (page renders without sections/blocks/styles):**
1. Check if a manually created `.html` file exists that overwrote the hook-generated one
2. Delete the `.html` file: `rm content/{page}.html`
3. Re-save the `.md` file (use Edit to trigger the hook) — hook will regenerate both files
4. Reload the preview

**Note:** `convert_markdown_to_html` is still useful for Document Authoring (DA) upload workflows, but NEVER for local preview content files.

---

## Skills Reference

This project has access to a comprehensive set of skills organized into three tiers: **Custom Local Skills** (project-specific, in `.claude/skills/`), **EXCAT Plugin Skills** (migration & development platform), and **Edge Delivery Services Skills** (foundational EDS operations).

---

### Custom Local Skills

These live in `.claude/skills/` and are specific to this project.

#### Design System Extraction (`get-general-styling`) — MUST run BEFORE page migration

**CRITICAL: When a user asks to migrate, import, or convert a site or page, ALWAYS suggest running the design system extraction skill FIRST if `styles/styles.css` still contains EDS boilerplate defaults. Do not proceed with page migration until the design foundation is set.**

**Trigger patterns:**
- User says: "migrate", "import", "convert" any site or page → check if design system was already extracted. If not, suggest it first.
- User says: "extract design", "get styling", "setup styles", "general styling", "design system" → invoke directly.
- User says: "start fresh", "new migration" → invoke as first step.

**How to invoke:**
Read and follow the complete workflow in `.claude/skills/get-general-styling.md`. Execute every phase in order. Do not skip phases. Mark each phase complete only after its validation checklist passes.

**When to skip:**
- Only skip if `migration-work/design-system-extracted.json` exists AND its `sourceDomain` matches the site being migrated.
- If migrating a DIFFERENT source site, run the extraction again.

**Bypass directive for other skills:**
Once `migration-work/design-system-extracted.json` exists with `"status": "complete"`, the following rules apply to ALL other skills during this migration session:

1. **Do NOT re-extract design tokens.** The `excat-complete-design-expert` skill and any design/style extraction steps within `excat-page-migration` or other skills MUST be skipped entirely. The design foundation is already set.
2. **Do NOT overwrite `styles/styles.css`** with boilerplate or re-extracted values. Only additive changes are allowed (e.g., adding block-specific CSS that does not conflict with the extracted design tokens).
3. **Do NOT re-extract colors, typography, spacing, or breakpoints.** These are already captured in the `migration-work/*.json` files and applied to `styles/styles.css`.
4. **DO allow block-specific styling** — blocks may still get their own CSS in `blocks/{blockname}/{blockname}.css`. This bypass only covers site-wide design tokens, not block-level styling.
5. **Check before any design operation:** Before running any design-related skill or sub-step, first check: `ls migration-work/design-system-extracted.json`. If it exists, read it, confirm the domain matches, and skip the design extraction work.

---

#### Navigation / Header Migration (`excat-navigation-orchestrator`)

**When a user asks to migrate, import, replicate, or instrument a site header or navigation, ALWAYS use the Navigation Orchestrator skill.** This applies to desktop nav bars, mobile hamburger menus, megamenus, dropdowns, locale selectors, and search bars within headers.

**Trigger patterns:**
- User says: "migrate header", "migrate navigation", "instrument header", "replicate nav", "set up header from URL" → invoke directly.
- User says: "migrate header from https://…" or provides a header screenshot → invoke directly.
- User says: "validate nav structure", "fix header", "header doesn't match source" → invoke for validation/remediation.

**How to invoke:**
Read and follow the complete workflow in `.claude/skills/excat-navigation-orchestrator/SKILL.md`. Execute every phase in order — desktop first (Phases 1–3, aggregate, implement, validate), then mobile only after customer confirmation. Do not skip phases or validation gates.

**Prerequisites:**
- The page must already be migrated (use `excat-page-migration` first if it isn't).
- The design system should already be extracted (see "Design System Extraction" above).
- A local dev server must be running at `http://localhost:3000`.
- Screenshot evidence is required — the skill will never assume header structure.

**Key rules:**
- Desktop implementation must include full CSS styling and megamenu images — no raw bullet lists.
- All text content, links, and labels go in `content/nav.md`, never hardcoded in `header.js`.
- Every component must reach ≥ 95% visual similarity via per-component critique before reporting to the customer.
- Mobile is implemented only after customer confirms desktop; mobile follows the same structural + style validation rigor.

**Sub-agents** (invoked automatically by the orchestrator):
- `desktop-navigation-agent` — Analyzes desktop header screenshots, detects row count, alignment groups, and maps each row to structured JSON.
- `mobile-navigation-agent` — Analyzes mobile header/nav behavior: breakpoints, hamburger logic, accordion vs drawer vs slide-in-panel, tap vs hover.
- `megamenu-analysis-agent` — Analyzes megamenu structure from open-state screenshots: trigger type, columns, nested levels, images, grid, animation.
- `validation-agent` — Compares implemented navigation to source screenshots, detects row/spacing/font/interaction mismatches, forces re-analysis on mismatch.
- `nav-component-critique` — Per-component visual critique: captures source and migrated screenshots, compares visually, scores similarity, generates CSS fixes, iterates until ≥ 95% match.

**Do NOT use for:** Simple link lists without screenshot evidence, pages not yet migrated, footer or non-header layout work.

---

#### Animation Migration (`excat-animate-migration`)

Auto-detect, analyze, and replicate animations from source webpages into Edge Delivery Services. Handles CSS animations, JavaScript animations, Lottie/bodymovin, scroll-triggered effects, counter animations, parallax, and custom animations. Recreates using EDS-compatible vanilla JS, CSS, and IntersectionObserver patterns.

**Trigger patterns:**
- "migrate animations", "replicate animations", "detect animations", "recreate animations"
- References to animation work on a source site

---

#### Project Management Skills

**Daily Status Checkup** (`excat-daily-status-checkup`)
Reviews the project journal, time tracking, and problem reference to build context for a new session or day. Produces a concise status briefing.

- Triggers: "status checkup", "where did we leave off", "catch me up", "what's the status", "daily checkup", "start of day", "resume", "session context"

**Journaling** (`excat-journaling`)
Maintains a running project journal that tracks sessions, actions taken, success/failure rates, problems encountered, resolutions, and time spent. Provides rapid context recovery between sessions.

- Triggers: "journal", "log session", "update journal", "what did we do last", "session summary", at start/end of sessions

**Problem Tracker** (`excat-problem-tracker`)
Reviews the project journal for problems, issues, and roadblocks. Extracts recurring patterns, tracks resolutions, and builds a knowledge base for quick lookup.

- Triggers: "update problem tracker", "review problems", "analyze problems", "what problems have we seen", "how did we fix X", "check knowledge base", "extract lessons learned"

**Project Time Tracking** (`excat-project-time-tracking`)
Compiles daily time reports from the project journal — actions taken, time per action, session totals, daily totals, and cumulative project time.

- Triggers: "time report", "how much time today", "daily summary", "time tracking", "project hours", "break out today's actions"

---

### EXCAT Plugin Skills

These are platform-level skills provided by the EXCAT plugin. They are invoked automatically based on task context.

#### Migration & Import

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `excat:excat-page-migration` | Migrates a single web page into Edge Delivery Services with block mapping, content extraction, markdown generation, and automatic block variant tracking/reuse. **Always use this for single page migrations.** | "migrate page", "import page", "convert URL to EDS" |
| `excat:excat-multi-page-import` | Orchestrates bulk import for multiple pages. Combines page templates with block parsers and page transformers. | "migrate URL1, URL2, URL3", "import all pages", "bulk import" |
| `excat:excat-import-infrastructure` | Creates import infrastructure (page templates, block parsers, page transformers) during single page migrations for future bulk import use. | Invoked automatically during page migration |
| `excat:excat-import-script` | Develops an Edge Delivery Services-compatible import script for importing similar pages by combining templates with block parsers and transformers. | "create import script", "build page importer" |
| `excat:generate-migration-markdown` | Generates EDS-compliant markdown from authoring analysis. Creates block tables with variant names, applies section metadata, handles page metadata, manages images. | Invoked by migration workflows |

#### Design & Styling

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `excat:excat-complete-design-expert` | Orchestrates complete design migration: site-level tokens, block-level styles, or both. Extracts and adapts design systems, colors, fonts, and CSS. | "design migration", "extract styles", "adapt design system", "migrate CSS" |
| `excat:excat-block-critique` | Validates and fixes styling of migrated blocks. Compares block visuals against original website, identifies CSS differences, generates fixes, iterates until pixel-perfect. | "validate block", "fix block styling", "compare block", "critique block" |
| `excat:excat-page-critique` | Validates and fixes styling of migrated pages. Full-page visual comparison against original, identifies differences, generates CSS fixes. | "validate page", "fix page styling", "compare page", "critique page" |

#### Block Development

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `excat:excat-eds-developer` | Develops Edge Delivery blocks: JavaScript decoration, CSS styling, AEM coding standards. | "implement block", "create block", "develop component", "block development" |
| `excat:block-variant-manager` | Manages block variant lifecycle: catalog loading, similarity matching (70% threshold), metadata.json management, variant creation with full metadata tracking. | Invoked by migration workflows for variant reuse |

#### Debugging & Navigation

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `excat:excat-eds-debugger` | Systematically debugs common Edge Delivery Services issues: blocks, images, CSS, and code sync problems. | "debug", "fix rendering", "block not working", "images not loading" |
| `excat:excat-navigation-expert` | Migrates, sets up, and troubleshoots navigation structures for Edge Delivery projects. Manages local nav.html. | "setup navigation", "fix nav", "migrate nav structure" |

#### Figma Integration

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `excat-figma:excat-figma-migration` | Migrates a single block or component from Figma to Edge Delivery Services. | Figma URLs, "convert Figma design to EDS block" |

---

### Edge Delivery Services Foundation Skills

These are foundational EDS skills for content modeling, page analysis, and block development.

| Skill | Description | Trigger Patterns |
|-------|-------------|-----------------|
| `edge-delivery-services:scrape-webpage` | Scrapes webpage content, extracts metadata, downloads images, prepares for import. Returns analysis JSON with paths, metadata, cleaned HTML, and local images. | "scrape page", "extract content from URL" |
| `edge-delivery-services:identify-page-structure` | Identifies section boundaries and content sequences within a scraped webpage. Two-level analysis: sections, then sequences per section. | "identify page structure", "analyze sections" |
| `edge-delivery-services:page-decomposition` | Analyzes content sequences within a section — neutral descriptions for EDS. Identifies breaking points between default content and blocks. | Invoked per section during page import |
| `edge-delivery-services:authoring-analysis` | Analyzes content sequences and determines authoring approach (default content vs blocks). Validates block selection and section styling. | "analyze authoring", "how should this content be authored" |
| `edge-delivery-services:block-inventory` | Surveys available blocks from local project and Block Collection. Returns block inventory with purposes. | "what blocks are available", "list blocks" |
| `edge-delivery-services:block-collection-and-party` | Repository of existing AEM blocks, build tools, code snippets, integration patterns, and plugins. Starting point for development. | "find a reference block", "block collection", "existing block examples" |
| `edge-delivery-services:building-blocks` | Guide for creating new blocks or making significant changes. Covers JavaScript decoration, CSS styling, and content model changes. | "create new block", "modify block", "block development guide" |
| `edge-delivery-services:content-modeling` | Creates effective content models for blocks that are easy for authors to work with. | "content model", "block authoring structure" |
| `edge-delivery-services:content-driven-development` | Applies Content Driven Development process to Edge Delivery Services. Use for all development tasks. | "content driven development", "CDD process" |
| `edge-delivery-services:generate-import-html` | Generates structured HTML from authoring analysis. Creates section structure, applies block tables, handles metadata, manages images. | Invoked during import workflows |
| `edge-delivery-services:preview-import` | Previews and verifies imported content in local dev server. Validates rendering, compares with original, troubleshoots issues. | "preview import", "verify imported page" |
| `edge-delivery-services:testing-blocks` | Guide for testing code changes: unit testing, browser testing with Playwright/Puppeteer, linting, performance validation. | "test blocks", "run tests", "validate code changes" |
| `edge-delivery-services:docs-search` | Searches the aem.live documentation for Edge Delivery Services features and implementation guidance. | "search docs", "how does X work in EDS", "aem.live documentation" |

---

### Hooks (Auto-triggered)

These scripts in `.claude/skills/hooks/` run automatically on certain events:

| Hook | Purpose |
|------|---------|
| `auto-convert-md.js` | Converts `.md` to `.plain.html` and `.html` on every markdown write/edit |
| `auto-lint-blocks.js` | Runs stylelint on block CSS files after changes |
| `html-utils.js` | Shared HTML utility functions used by other hooks |
| `nav-validation-gate.js` | PostToolUse gate hook for navigation validation (17 gates + 12 stop checks) |
